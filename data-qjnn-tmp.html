<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>奇迹暖暖</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="css/qjnn.css">
</head>

<body>
<div class="switchboard">
    <div class="l">
    	<i></i>
        <a id="btn_dialog_arena">搭配竞技场</a>
    </div>
    <div class="r">
    	<i></i>
    	<a id="btn_dialog_wu">五属性模拟器</a>
    </div>
</div>

<div class="switchbute">
	<i class="flower_l"></i>
    <i class="flower_r"></i>
    <div class="title">
    	已选属性/主题
    </div>
    <div class="content" id="selectedbute">
    	<div class="item">简约</div>
    	<div class="item">可爱</div>
        <div class="item">活泼</div>
        <div class="item">清纯</div>
        <div class="item">清凉</div>
    </div>
</div>

<div class="filter_warp">
	<div class="filter" id="filter">
    	<div class="filter_inner">
            <a class="item on">发型</a>
            <a class="item">连衣裙</a>
            <a class="item">连衣裙</a>
            <a class="item">连衣裙</a>
            <a class="item">连衣裙</a>
        </div>
    </div>
</div>

<div class="clothes_wrap">
	<i class="flower_top_left"></i>
    <i class="flower_top_right"></i>
    <i class="flower_bottom_left"></i>
    <i class="flower_bottom_right"></i>
    <i class="line_top"></i>
    <i class="line_right"></i>
    <i class="line_bottom"></i>
    <i class="line_left"></i>
    <div class="clothes" id="clothes">
    	<a class="item">
        	<div class="l">
            	<div class="t">
                	<div>乖顺使者的·马甲</div>
                    <i class="t_l"></i>
                    <i class="t_m"></i>
                    <i class="t_r"></i>
                </div>
                <div class="b">
                	<div><span>简约</span></div>
                    <div><span>性感</span></div>
                </div>
            </div>
            <div class="r">99</div>
        </a>
        <a class="item">
        	<div class="l">
            	<div class="t">
                	<div>乖顺使者的乖顺使者的·马甲</div>
                    <i class="t_l"></i>
                    <i class="t_m"></i>
                    <i class="t_r"></i>
                </div>
                <div class="b">
                	<div><span>简约</span></div>
                    <div><span>性感</span></div>
                </div>
            </div>
            <div class="r">13</div>
        </a>
        <a class="item">
        	<div class="l">
            	<div class="t">
                	<div>乖顺使者的·马甲</div>
                    <i class="t_l"></i>
                    <i class="t_m"></i>
                    <i class="t_r"></i>
                </div>
                <div class="b">
                	<div><span>简约</span></div>
                    <div><span>性感</span></div>
                </div>
            </div>
            <div class="r">13</div>
        </a>
    </div><!--/clothes-->
</div><!--/clothes_wrap-->

<div class="dialog_attr" id="dialog_wu">
	<div class="dialog_content dialog_five">
    	<div class="item">
        	<a class="btn_radio on" data-label="jianyue">简约</a>
            <a class="btn_radio" data-label="huali">华丽</a>
        </div>
        <div class="item">
        	<a class="btn_radio on" data-label="keai">可爱</a>
            <a class="btn_radio" data-label="chengshu">成熟</a>
        </div>
        <div class="item">
        	<a class="btn_radio on" data-label="huopo">活泼</a>
            <a class="btn_radio" data-label="youya">优雅</a>
        </div>
        <div class="item">
        	<a class="btn_radio on" data-label="qingchun">清纯</a>
            <a class="btn_radio" data-label="xinggan">性感</a>
        </div>
        <div class="item">
        	<a class="btn_radio" data-label="qingliang">清凉</a>
            <a class="btn_radio on" data-label="baonuan">保暖</a>
        </div>
    </div>
    <i class="line_l"></i>
    <i class="line_m"></i>
    <i class="line_r"></i>
    <div class="handle">
    	<a class="btn_cancel">取消</a>
        <a class="btn_sure" data-type="1">确定</a>
    </div>
</div>

<div class="dialog_attr" id="dialog_arena">
	<div class="dialog_content dialog_arena">
        <div class="item"><a class="btn_arena on">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐金色音乐厅厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
        <div class="item"><a class="btn_arena">金色音乐厅</a></div>
    </div>
    <i class="line_l"></i>
    <i class="line_m"></i>
    <i class="line_r"></i>
    <div class="handle">
    	<a class="btn_cancel">取消</a>
        <a class="btn_sure" data-type="2">确定</a>
    </div>
</div>

<div class="dialog_det" id="dialog_det">
	<div class="title">
    	<div class="l"><i></i></div>
        <div class="m">乖顺使者的马甲马甲马甲马甲马甲</div>
        <div class="r"><i></i></div>
    </div>
    <div class="content">
    	<div class="item">华丽&middot;S</div>
        <div class="item">华丽&middot;S</div>
        <div class="item">华丽&middot;S</div>
        <div class="item">华丽&middot;S</div>
        <div class="item">华丽&middot;S</div>
    </div>
    <div class="spe">
    	<div>特殊属性1</div>
        <div>特殊属性2</div>
    </div>
    <div class="title">
    	<div class="l"><i></i></div>
        <div class="m m2">获取途径</div>
        <div class="r"><i></i></div>
    </div>
    <div class="content2">
    	<div>6-7（少女级）</div>
        <div>6-7（少女级）</div>
    </div>
</div>

<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="js/iscroll-lite.js"></script>
<script type="text/javascript" src="js/easydialog.min.js"></script>
<script type="text/javascript">
$(function(){	
	var qjnnFun = function(option){
		if(typeof(arguments[0]) == 'undefined') return false;
		var option = typeof(arguments[0]) == 'object' ? arguments[0] : {};
		this.dataclothes = option.data_clothes;
		this.dataarena = option.data_arena;
		this.datatype = option.data_type;
		this.o = {type:1,clothestype:0,zhuti:"",label1:"jianyue",label2:"keai",label3:"huopo",label4:"qingchun",label5:"baonuan"};
		
		this.init();
	}
	
	qjnnFun.prototype = {
		printFilterclothes: function(){//打印横向滑动选择 头发/连衣裙/外套
			var _html = '',
			_datatype = this.datatype,
			i;
			for(i=0; i<_datatype.length; i++){
				_html += '<a class="item" data-id="'+_datatype[i].id+'">'+_datatype[i].name+'</a>';
			}
			$("#filter .filter_inner").html(_html);
		},
		filterclothesScroll: function(){//设置横向滑动条
			var $parent = $("#filter"),
			$sub = $parent.find("a.item"),
			_w = 0;

			$sub.each(function(){
				_w += $(this).innerWidth();
			});
			
			$parent.children().width(_w);//先设置宽度
			
			var myscroll = new IScroll("#filter", {//再设置滑动
				scrollX: true,
				scrollY: false,
				click: true
			});
		},
		printArena: function(){//打印搭配竞技场
			var _html = '',
			_dataarena = this.dataarena,
			i;
			for(i=0; i<_dataarena.length; i++){
				_html += '<div class="item"><a class="btn_arena" data-id="'+_dataarena[i].id+'">'+_dataarena[i].name+'</a></div>';
			}
			$("#dialog_arena .dialog_content").html(_html);
		},
		printClothes:function(index){//打印衣服组
			var _html = '',
			that = this,
			_dataclothes = that.dataclothes,
			newdata = [];
			
			function calclabel(){//计算看是不是属于5属性
				var _wu = arguments[0],
				k;
				for(k in _wu){
					switch(k){
						case that.o.label1:break;
						case that.o.label2:break;
						case that.o.label3:break;
						case that.o.label4:break;
						case that.o.label5:break;
						default:return false;
					}
				}
				return true;
			}
			
			function calcScore(){//计算衣服的数值和最高的2个标签
				var _wu = arguments[0].wu,
				isCalcLabel = arguments[1],
				_obj = {score:0,high1:"",high2:""},
				k,
				score,
				i = 0,
				temp1 = {},
				temp2 = {},
				temp3 = {};
				
				for(k in _wu){
					score = _wu[k];
					if(isCalcLabel !== undefined){//判断要不要算出最高分数的2个标签
						if(i == 0){
							temp1 = {k:k,v:score};//赋值第1个
						}else if(i == 1){
							temp2 = {k:k,v:score};//赋值第2个
							if(temp1.v > temp2.v){//先默认排成第2个比第1个大
								temp3 = temp2;
								temp2 = temp1;
								temp1 = temp3;
							}
						}else if(i > 1){//从第3个开始对比
							if(score > temp1.v && score <= temp2.v){//如果第n个数比第1个大且小于等于第2个，则把第n个数赋值给第1个
								temp1 = {k:k,v:score};
							}else if(score > temp2.v){//如果第n个数比第2个大，则把第2个数赋值给第1个，第n个赋值给第2个
								temp1 = temp2;
								temp2 = {k:k,v:score};
							}
						}
					}
					_obj.score += score;//加起来获得总数
					i++;
				}
				
				_obj.high1 = that.switchlael(temp1.k);
				_obj.high2 = that.switchlael(temp2.k);
				return _obj;
			}
			
			for(var i=0; i<_dataclothes.length; i++){//过滤衣服类别+五属性
				if(_dataclothes[i].type == that.o.clothestype && calclabel(_dataclothes[i].wu)){
					newdata.push({k:_dataclothes[i],v:calcScore(_dataclothes[i]).score});
				}
			}

			function sortNumber(a,b){
				return a.v - b.v;
			}
			newdata.sort(sortNumber);//对过滤完后的数组排序
			
			
			for(var i=0; i<newdata.length; i++){//对排完序的衣服打印出来
				var _newdata = newdata[i].k;
				var scoreobj = calcScore(newdata[i].k, "needcompare");//需要算出最高分数的2个标签
					_html += '<a class="item" data-id="'+_newdata.id+'">'+
								'<div class="l">'+
									'<div class="t">'+
										'<div>'+_newdata.name+'</div>'+
										'<i class="t_l"></i>'+
										'<i class="t_m"></i>'+
										'<i class="t_r"></i>'+
									'</div>'+
									'<div class="b">'+
										'<div><span>'+scoreobj.high1+'</span></div>'+
										'<div><span>'+scoreobj.high2+'</span></div>'+
									'</div>'+
								'</div>'+
								'<div class="r">'+scoreobj.score+'</div>'+
							'</a>';
			}

			$("#clothes").html(_html);
		},
		switchlael: function(){
			switch(arguments[0]){
				case "jianyue":return "简约";
				case "huali":return "华丽";
				case "keai":return "可爱";
				case "chengshu":return "成熟";
				case "huopo":return "活泼";
				case "youya":return "优雅";
				case "qingchun":return "清纯";
				case "xinggan":return "性感";
				case "qingliang":return "清凉";
				case "baonuan":return "保暖";
			}
		},
		selectedbute: function(){//选择哪些属性
			var _html;
			if(this.o.type == 1){
				_html = '<div class="item">'+this.switchlael(this.o.label1)+'</div>'+
						'<div class="item">'+this.switchlael(this.o.label2)+'</div>'+
						'<div class="item">'+this.switchlael(this.o.label3)+'</div>'+
						'<div class="item">'+this.switchlael(this.o.label4)+'</div>'+
						'<div class="item">'+this.switchlael(this.o.label5)+'</div>';
			}else{
				_html = '<div class="item">'+this.o.zhuti+'</div>';
			}
			$("#selectedbute").html(_html);
			
			this.printClothes();
		},
		showclothes: function(data_id){//打开单个衣服展示详情
			var data_id = data_id,
			that = this,
			_dataclothes = that.dataclothes;
			for(var i=0; i<_dataclothes.length; i++){
				if(_dataclothes[i].id == data_id){
					_dataclothes = _dataclothes[i];
				}
			}
			function rate(){//评级s
				var k,
				r = "",
				_html = "";
				for(k in _dataclothes.wu){
					switch(_dataclothes.wu[k]){
						case 3:r="B";break;
						case 4:r="A";break;
						case 5:r="S";break;
						case 6:r="SS";break;
						default:r="C";
					}
					_html += '<div class="item">'+that.switchlael(k)+'&middot;'+r+'</div>';
				}
				return _html;
			}
			function spec(){//特殊属性
				var _html = "";
				if(_dataclothes.t1 || _dataclothes.t1){
					_html = '<div class="spe">'+
								'<div>'+_dataclothes.t1+'</div>'+
								'<div>'+_dataclothes.t2+'</div>'+
							'</div>';
				}
				return _html;
			}
			function gain(){//获取途径
				var _html = "",
				_arr;
				if(_dataclothes.g){
					_arr = _dataclothes.g.split("/");
					for(var i=0; i<_arr.length; i++){
						_html += '<div>'+_arr[i]+'</div>';
					}
				}
				return _html;
			}
			
			var _html = '<div class="title">'+
							'<div class="l"><i></i></div>'+
							'<div class="m">'+_dataclothes.name+'</div>'+
							'<div class="r"><i></i></div>'+
						'</div>'+
						'<div class="content">'+rate()+'</div>'+
						spec()+
						'<div class="title">'+
							'<div class="l"><i></i></div>'+
							'<div class="m m2">获取途径</div>'+
							'<div class="r"><i></i></div>'+
						'</div>'+
						'<div class="content2">'+
							gain()+
						'</div>';
						
			$("#dialog_det").html(_html);
		},
		events: function(){
			var that = this;
			//选中横向滑动衣服类别
			$("#filter .item").click(function(){
				that.o.clothestype = $(this).attr("data-id");
				$(this).addClass("on").siblings().removeClass("on");
				that.selectedbute();
			});
			
			//竞技场打开弹窗
			$("#btn_dialog_arena").click(function(){
				easyDialog.open({
				  container: "dialog_arena",
				  fixed : false
				});
			});
			//五属性打开弹窗
			$("#btn_dialog_wu").click(function(){
				easyDialog.open({
				  container: "dialog_wu",
				  fixed : false
				});
			});
			//衣服打开弹窗
			$(".clothes").on("click", ".item", function(){
				that.showclothes($(this).attr("data-id"));
				easyDialog.open({
				  container: "dialog_det",
				  fixed : false
				});
			});
			//关闭2个弹窗
			$(".btn_cancel,#dialog_det").click(function(){
				easyDialog.close();
			});
			//在五属性里面选择
			$("#dialog_wu .btn_radio").click(function(){
				$(this).addClass("on").siblings().removeClass("on");
			});
			//在竞技场里面选择
			$("#dialog_arena").on("click", ".btn_arena", function(){
				$(this).addClass("on").parent().siblings().children().removeClass("on");
			});
			//点五属性或则竞技场的确定
			$(".btn_sure").click(function(){
				if($(this).attr("data-type") == 1){//五属性
					that.o.type = 1;
					$("#dialog_wu .item").each(function(index){
						switch(index){
							case 0:that.o.label1 = $(this).children(".on").attr("data-label");break;
							case 1:that.o.label2 = $(this).children(".on").attr("data-label");break;
							case 2:that.o.label3 = $(this).children(".on").attr("data-label");break;
							case 3:that.o.label4 = $(this).children(".on").attr("data-label");break;
							case 4:that.o.label5 = $(this).children(".on").attr("data-label");break;
						}
                    });
				}else{
					that.o.type = 2;//竞技场
					var dataarena_id = $("#dialog_arena .on").attr("data-id");
					for(var i=0; i<that.dataarena.length; i++){
						var _dataarena_item = that.dataarena[i];
						if(dataarena_id == _dataarena_item.id){
							that.o.zhuti = _dataarena_item.name;
							that.o.label1 = _dataarena_item.wu[0];
							that.o.label2 = _dataarena_item.wu[1];
							that.o.label3 = _dataarena_item.wu[2];
							that.o.label4 = _dataarena_item.wu[3];
							that.o.label5 = _dataarena_item.wu[4];
						}
					}
				}
				that.selectedbute();
				easyDialog.close();
			});
		},
		init: function(){
			this.printFilterclothes();
			this.events();
			$("#filter .item").eq(0).trigger("click");
			this.filterclothesScroll();
			this.printArena();
			
			
		}
	}

/*
1:简约,2:华丽,3:可爱,4:成熟,5:活泼,6:优雅,7:清纯,8:性感,9:清凉,10:保暖
jianyue:0,huali:0,keai:0,chengshu:0,huopo:0,youya:0,qingchun:0,xinggan:0,qingliang:0,baonuan:0
1:头发,2:连衣裙,3:外套,4:上衣,5:下装,6:袜子,7:鞋,8:头饰,9:耳饰,10:颈饰...

2 C
3 B
4 A
5 S
6 SS
*/

	
	var data_clothes = [{id:8144,name:"默认粉毛",type:317,t1:"特殊属性1",t2:"墨墨",g:"店/迷/6-7少",wu:{jianyue:6,huopo:0,keai:3,qingchun:5,baonuan:5}},{id:8145,name:"运动少年",type:317,t1:"特殊属性1",t2:"特殊属性2",g:"签到",wu:{jianyue:6,huopo:6,keai:6,qingchun:6,qingliang:5}},{id:8145,name:"金色音乐厅专用",type:317,t1:"特殊属性1",t2:"特殊属性2",g:"签到",wu:{huali:5,chengshu:5,youya:4,xinggan:5,baonuan:5}},{id:8145,name:"连衣裙金色音乐厅专用",type:318,t1:"特殊属性1",t2:"特殊属性2",g:"签到",wu:{huali:5,chengshu:5,youya:4,xinggan:5,baonuan:5}},{id:8146,name:"不羁",type:317,t1:"",t2:"",g:"",wu:{jianyue:5,huopo:5,keai:4,qingchun:5,qingliang:5}},{id:8434,name:"白翩语",type:318,t1:"",t2:"",g:"暂无",wu:{jianyue:5,huopo:5,keai:4,qingchun:5,qingliang:5}}];
	var data_arena = [{id:10130,name:"金色音乐厅",wu:["huali","chengshu","youya","xinggan","baonuan"]},{id:10131,name:"秋日物语",wu:["jianyue","keai","huopo","qingchun","baonuan"]},{id:10132,name:"海边派对的搭配",wu:["jianyue","keai","huopo","xinggan","qingliang"]},{id:10133,name:"冬天里的一把火",wu:["huali","keai","huopo","xinggan","baonuan"]}];
	var data_type = [{id:317,name:"头发"},{id:318,name:"连衣裙"},{id:319,name:"外套"},{id:320,name:"上衣"},{id:321,name:"下装"},{id:322,name:"袜子"}];
	var data_all = {data_clothes:data_clothes, data_arena:data_arena, data_type:data_type}
	var qjnn = new qjnnFun(data_all);


});

</script>
</body>
</html>
